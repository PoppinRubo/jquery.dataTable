///////////////////////////////////////
/* dataTable 压缩版,版本号1.2.5 */
///////////////////////////////////////
var CheckData={};var GetJSONData={};(function(d){var DebugMsg=false;var TableSet={};d.fn.dataTable=function(Obj){DebugMsg=false;var t=d(this);ClearTable(t);try{var tid=t[0].id}catch(Ex){}var page=1;function CreateTable(Object,Table,TableID,page){if(empty(TableSet[TableID])){TableSet[TableID]={Object:Object,Table:Table}}TableSet[TableID].Object.url=Object.url;var pageCapacity=10;if(!empty(Object.pageCapacity)){TableSet[TableID].Object.pageCapacity=Object.pageCapacity}else{if(empty(TableSet[TableID].Object.pageCapacity)){TableSet[TableID].Object.pageCapacity=pageCapacity}}Object=TableSet[TableID].Object;Table=TableSet[TableID].Table;pageCapacity=TableSet[TableID].Object.pageCapacity;if(!empty(Object.debug)){DebugMsg=Object.debug}var columns=Object.columns;if(empty(columns)){debug(TableID+"未绑定columns");return false}if(empty(Table[0])){debug("未找到指定的table,检查table是否存在");return false}Table.append("<tr class='"+TableID+"_dt_head'></tr>");for(var h=0;h<columns.length;h++){var w=Object.columns[h]["width"];var width="auto";if(!empty(w)){width=w+"px"}Table.find("tr").eq(0).append("<td class='"+TableID+"_td_head' style='width:"+width+";'>"+columns[h]['title']+"</td>")}if(!empty(Object.check)){if(Object.check){Table.find("tr").eq(0).prepend("<td class='"+TableID+"_td' title='全选' style='width:25px'><input class='"+TableID+"_dt_check_all' type='checkbox'></td>")}}TableStyle();function TableStyle(){Table.css({"border-collapse":"collapse","font-family":'"Microsoft YaHei", "微软雅黑", helvetica, arial, verdana, tahoma, sans-serif',"font-size":"14px","table-layout":"fixed","position":"absolute","left":" 0","top":"0"});Table.find("td").css({"border":"1px solid #d8d8d8","padding":"5px","overflow":"hidden","white-space":"nowrap","cursor":"pointer","text-align":"left"});Table.find("tr").eq(0).find("td").css({"cursor":"auto"});Table.find("tr").eq(0).find("td").eq(0).css({"cursor":"pointer"});titltImg(Table);Table.find("."+TableID+"_dt_checkbox,."+TableID+"_dt_check_all").css({"width":"15px","height":"15px","margin":"0 auto","display":"block"});Table.find(".Button").css({"padding":"2px 10px","overflow":"hidden","white-space":"nowrap","text-align":"center","line-height":"100%","border-radius":"3px","background":" #232323","-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none","color":"#ffffff","z-index":"100","cursor":"pointer"});var ButtonStyle=Object.ButtonStyle;if(!empty(ButtonStyle)){Table.find(".Button").css({"background":ButtonStyle.backgroundColor,"color":ButtonStyle.fontColor})}DifferentStyle(Table,Object);Table.find("tr").hover(function(){if(this.className!=TableID+"_dt_head"){this.style.backgroundColor="#d8d8d8"}},function(){this.style.backgroundColor="rgba(216, 216, 216, 0)";DifferentStyle(Table,Object)});var TableStyle=Object.style;if(!empty(TableStyle)){Table.css(TableStyle)}var align=Object.align;if(!empty(align)){Table.find("."+TableID+"_td").css("text-align",align);Table.find("."+TableID+"_td_head").css("text-align",align)}}var url=Object.url;if(empty(url)){debug(TableID+"未绑定url");TableStyle();return false}$.ajax({type:"GET",url:url,data:{pager:JSON.stringify({"page":page,"pageCapacity":pageCapacity})},contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){Animation(TableID,'start')},success:function(json){Animation(TableID,'stop');var total=json.total;json=json.rows;if(json!=null){dataCreateTable(TableID,total,json,Table,columns,Object)}else{debug(TableID+"返回数据为空,或返回格式不正确")}},error:function(msg){Animation(TableID,'stop');status(TableID,msg)}});function dataCreateTable(TableID,total,json,Table,columns,Object){GetJSONData[TableID]=json;for(var r=0;r<json.length;r++){Table.append("<tr data-row='"+parseInt(r+2)+"'></tr>");for(var c=0;c<columns.length;c++){var ColumnContent=json[r][columns[c].ColumnName];var ColumnTitle=ColumnContent;var facility=Object.columns[c]["button"];if(!empty(facility)){if(facility==""){debug(TableID+"未定义按钮");return false}var buttonName=Object.columns[c]["buttonName"];if(empty(buttonName)||buttonName==""){debug(TableID+"自定义按钮未设置按钮名");return false}ColumnContent="<span data-button='"+facility+"' class='"+TableID+"_button_"+facility+" Button'>"+buttonName+"</span>";ColumnTitle=buttonName}var img=Object.columns[c]["img"];if(!empty(img)&&img){Table.find("tr").eq(r+1).append("<td class='"+TableID+"_td' data-row='"+parseInt(r+2)+"'><img src='"+ColumnContent+"' class='img'><span class='showImgBox'><img src='"+ColumnContent+"' class='showImg'></span></td>")}else{Table.find("tr").eq(r+1).append("<td class='"+TableID+"_td' data-row='"+parseInt(r+2)+"' title='"+ColumnTitle+"'>"+ColumnContent+"</td>")}}if(!empty(Object.check)){if(Object.check){Table.find("tr").eq(r+1).prepend("<td class='"+TableID+"_td_checkbox'><input class='"+TableID+"_dt_checkbox' type='checkbox'></td>")}}}if(json.length>0){var totalPage=Math.ceil(total/pageCapacity);var pager="<div class='tablePager' style='width: 100%;position: absolute;height: 35px;'>"+"<span style='float: left;margin: 10px;'>显示条数:</span>"+"<select class='Button "+TableID+"_select'>"+"<option>10</option><option>20</option><option>30</option><option>40</option><option>50</option></select>"+"<span class='Button "+TableID+"_firstPage' title='跳到第一页'>首页</span>"+"<span class='Button "+TableID+"_aPage' title='上一页'>上一页</span>"+"<span class='Button "+TableID+"_nextPage' title='下一页'>下一页</span>"+"<span class='Button "+TableID+"_endPage' title='跳到最后一页'>尾页</span>"+"<span class='"+TableID+"_PageInput' style='float: left;'>"+"<input class='"+TableID+"_inp' maxlength='5' placeholder='跳页' style='width: 50px;margin: 6px;'>"+"</span><span class='Button "+TableID+"_ok' title='跳到目标页'>确定</span>"+"</span><span class='Button "+TableID+"_refresh' title='刷新表格数据'>刷新</span>"+"<span class='"+TableID+"_page_tip' style='float: left;margin: 10px;'>当前在第"+page+"页,总页"+totalPage+"页</span></div>";Table.append(pager)}TableStyle();var inp=$("."+TableID+"_inp");inp.keydown(function(e){var code=parseInt(e.keyCode);return!!(code>=96&&code<=105||code>=48&&code<=57||code==8)});inp.bind("input propertychange",function(){if(isNaN(parseFloat($(this).val()))||parseFloat($(this).val())<=0)$(this).val("")});Table.find(".tablePager").find(".Button").css({"float":"left","padding":"5px","margin":"5px"});var CapacitySelect=Table.find(".tablePager").find("."+TableID+"_select");CapacitySelect.css({"padding":"1px"});inp.css({"border-radius":"10px","padding-left":"10px","border":"solid 1px #d8d8d8","outline":"none"});var op=Object.pageCapacity;if(op!=10&&op!=20&&op!=30&&op!=40&&op!=50){CapacitySelect.prepend("<option>"+op+"</option>")}CapacitySelect.val(Object.pageCapacity);CapacitySelect.change(function(){Object.pageCapacity=CapacitySelect.val();ClearTable(Table);CreateTable(Object,Table,TableID,page=1)});var firstPage=Table.find(".tablePager").find("."+TableID+"_firstPage");firstPage.click(function(){if(page==1){return false}page=1;pagControl(page);ClearChoice(TableID);UpdateData(Object,Table,TableID,page)});var Refresh=Table.find(".tablePager").find("."+TableID+"_refresh");Refresh.click(function(){pagControl(page);ClearChoice(TableID);UpdateData(Object,Table,TableID,page)});var aPage=Table.find(".tablePager").find("."+TableID+"_aPage");aPage.click(function(){if(page==1){return false}page--;pagControl(page);UpdateData(Object,Table,TableID,page)});var nextPage=Table.find(".tablePager").find("."+TableID+"_nextPage");nextPage.click(function(){if(page==totalPage){return false}page++;pagControl(page);ClearChoice(TableID);UpdateData(Object,Table,TableID,page)});var endPage=Table.find(".tablePager").find("."+TableID+"_endPage");endPage.click(function(){if(page==totalPage){return false}page=totalPage;pagControl(page);ClearChoice(TableID);UpdateData(Object,Table,TableID,page)});var PageOk=Table.find(".tablePager").find("."+TableID+"_ok");PageOk.click(function(){JumpPage()});inp.keydown(function(e){if(e.keyCode==13){JumpPage()}});function JumpPage(){var p=inp.val();if(p<1||p>totalPage){return false}page=p;pagControl(page);ClearChoice(TableID);UpdateData(Object,Table,TableID,page)}function pagControl(p){if(p>1){aPage.css({"cursor":"pointer"});firstPage.css({"cursor":"pointer"})}if(p==1){aPage.css({"cursor":"not-allowed"});firstPage.css({"cursor":"not-allowed"})}if(p<totalPage){nextPage.css({"cursor":"pointer"});endPage.css({"cursor":"pointer"})}if(p==totalPage){nextPage.css({"cursor":"not-allowed"});endPage.css({"cursor":"not-allowed"})}}var ClearChoice=function(t){};pagControl(page);if(!empty(Object.check)){if(Object.check){Table.find("."+TableID+"_td").click(function(ev){if(ev.target===this&&this.parentNode.className!=TableID+"_dt_head"){this.parentNode.firstChild.firstChild.click()}if(ev.target===this&&this.firstChild.className==TableID+"_dt_check_all"){$("."+TableID+"_dt_check_all").click()}});Table.find("."+TableID+'_td_checkbox').click(function(ev){if(ev.target===this){this.firstChild.click()}});var dt_checkbox=$("."+TableID+"_dt_checkbox");dt_checkbox.click(function(){var C=[];var data=null;var r=0;for(var i=0;i<dt_checkbox.length;i++){r=GerRowData(dt_checkbox.eq(i)[0].parentNode.nextSibling);if(dt_checkbox.eq(i)[0].checked){data=GetJSONData[TableID][r-2];C.push(data)}}if(C.length<1){C=null}CheckData[TableID]=C});var all=0;$("."+TableID+"_dt_check_all").click(function(){if(all==0){dt_checkbox.click();dt_checkbox.prop("checked",true);all=1}else{dt_checkbox.click();dt_checkbox.prop("checked",false);all=0}});ClearChoice=function(TableID){var check_all=$("."+TableID+"_dt_check_all");if(check_all.is(':checked')){check_all.click()}var checked=$("."+TableID+"_dt_checkbox");for(var i=0;i<checked.length;i++){if(checked.eq(i).is(':checked')){checked.eq(i).click()}}}}}Table.find("."+TableID+"_td").find(".Button").click(function(){var button=this.getAttribute("data-button");var data=GetClickRowData(this,0,TableID);try{Object[button+"Click"](data)}catch(Ex){}});var sign=true;if(!empty(Object.sign)){sign=Object.sign}if(sign){Table.find("."+TableID+"_td").click(function(ev){if(ev.target===this&&this.parentNode.className!=TableID+"_dt_head"){Table.find("tr").find("td").css({"border":"1px solid #d8d8d8","padding":"5px"});var firstChildren=$(this).parent().children(":first");var style="#232323";if(!empty(Object.ButtonStyle)){style=Object.ButtonStyle.backgroundColor}firstChildren.css({"border-left":"5px solid "+style,"padding":"0 3px 0 0"})}})}var TimeFn=null;Table.find("."+TableID+"_td").click(function(ev){if(empty(Object.Click)){return}var t=this;clearTimeout(TimeFn);TimeFn=setTimeout(function(){if(ev.target===t&&t.parentNode.className!=TableID+"_dt_head"){var data=GetClickRowData(t,2,TableID);Object.Click(data)}},300)});Table.find("."+TableID+"_td").dblclick(function(ev){if(empty(Object.doubleClick)){return}clearTimeout(TimeFn);if(ev.target===this&&this.parentNode.className!=TableID+"_dt_head"){var data=GetClickRowData(this,2,TableID);Object.doubleClick(data)}})}}CreateTable(Obj,t,tid,page)};function titltImg(Table){Table.find(".img").css({"width":"40px","height":"40px","margin":"0 0 -5px 0"});Table.find(".showImgBox").css({"position":"absolute","z-index":1000,"display":"none","padding":"10px","background":"#FFFFFF","border-radius":"3px","box-shadow":"rgba(153, 153, 153, 0.3) 0px 0px 0px 1px"});Table.find(".showImg").css({"max-width":"300px"});var showImg=Table.find(".img");showImg.hover(function(){var imgBox=$(this).next(),marginTop=0,marginLeft=40,tableHeight=Table.height(),tableWidth=Table.width(),imgBoxHeight=imgBox.height(),imgBoxWidth=imgBox.width(),trTop=$(this).parent().parent().position().top,tdLeft=$(this).parent().position().left;if(tableHeight-trTop-imgBoxHeight<35){marginTop=-eval(imgBoxHeight+60)}if(tableWidth-tdLeft-imgBoxWidth<0){marginLeft=-eval(imgBoxWidth+20)}imgBox.css({"margin":marginTop+"px 0 0 "+marginLeft+"px","display":"block"});window.console.log(tableWidth-tdLeft-imgBoxWidth)},function(){$(this).next().css({"display":"none"})})}function empty(b){return typeof(b)=="undefined"}function status(TableID,msg){var statusTips="";if(msg.status==404){statusTips=",出现此情况一般为URL不正确未请求到后台"}else if(msg.status==500){statusTips=",出现此情况一般为后台程序发生错误"}debug(TableID+"后台信息,状态码:"+msg.status+",描述:"+msg.statusText+statusTips)}function DifferentStyle(t,Object){var oddEven=true;var Set=Object.oddEven;if(!empty(Set)){oddEven=Set}if(!oddEven){return}var row=t.find('tr');var num=0;for(var i=0;i<row.length;i++){num=row.eq(i+1).attr(("data-row"));if(num%2==0){row.eq(i+1).css({"background-color":"#f2f2f2"})}}}function GetClickRowData(c,t,tid){var row=0;if(t==0){row=GerRowData(c.parentNode)}if(t==2){row=GerRowData(c)}if(row==0){return null}var RowData=GetJSONData[tid][row-2];RowData.LineNumber=row;return RowData}function Animation(TableID,o){if(!empty(TableSet[TableID].Object.loading)){if(!TableSet[TableID].Object.loading){return false}}var table=$('#'+TableID);var top=table.height()/2;var width=table.width();var height=table.height();var startAnimation=null;var TableLoading=$('#'+TableID+"_loading");if(o=="start"){if(TableLoading.length>0){TableLoading.remove()}var style="#232323";if(!empty(TableSet[TableID].Object.ButtonStyle)){style=TableSet[TableID].Object.ButtonStyle.backgroundColor}var loading='<div id="'+TableID+'_loading" style="position: absolute;left: 0;top:0;color:#232323;background:rgba(250, 250, 250, 0.7);z-index: 500;width: '+width+'px;height: '+height+'px;'+'text-align: center;font-size: 14px;font-family:Helvetica Neue,Helvetica,Arial,PingFang SC,Hiragino Sans GB,WenQuanYi Micro Hei,Microsoft Yahei,sans-serif;">'+'<span style="margin-top: '+top+'px;left:'+eval(50-(20/width))+'%;position: absolute;"><span class="dt_animation" style="position:relative;width:20px;height:20px;background:'+style+';">&nbsp;&nbsp;</span></span>'+'<span style="margin-top: '+eval(top+20)+'px;left:'+eval(50-(20/width))+'%;position: absolute;color: '+style+';">加载中...</span></div>';table.append(loading);var dt_animation=$(".dt_animation");startAnimation=function(){dt_animation.animate({left:10},"slow");dt_animation.animate({left:30},"slow");dt_animation.animate({left:10},"slow");dt_animation.animate({left:0},"slow",startAnimation)};startAnimation()}if(o=="stop"){startAnimation=null;TableLoading.remove()}}function ClearTable(t){t.html("")}function UpdateData(Object,Table,TableID,page){var columns=Object.columns;var pageCapacity=Object.pageCapacity;$.ajax({type:"GET",url:Object.url,data:{pager:JSON.stringify({"page":page,"pageCapacity":pageCapacity})},contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(){Animation(TableID,'start')},success:function(json){Animation(TableID,'stop');if(json!=null){var total=json.total;json=json.rows;if(json!=null){var jsonCount=json.length;GetJSONData[TableID]=json;for(var r=0;r<jsonCount;r++){for(var c=0;c<columns.length;c++){var ColumnContent=json[r][columns[c].ColumnName];var table_td=Table.find("tr").eq(r+1).find("."+TableID+"_td").eq(c);if(table_td.find("img").length>0){table_td.html("<img src='"+ColumnContent+"' class='img'><span class='showImgBox'><img src='"+ColumnContent+"' class='showImg'></span>");titltImg(Table)}else{table_td.html(ColumnContent);table_td.attr("title",ColumnContent)}}}var totalPage=Math.ceil(total/pageCapacity);$("."+TableID+"_page_tip").html("当前在第"+page+"页,总页"+totalPage+"页");if(jsonCount<pageCapacity){var poor=pageCapacity-jsonCount;for(var i=1;i<=poor;i++){Table.find("tr").eq(jsonCount+i).hide()}}else{Table.find("tr").show()}Table.find("tr").find("td").css({"border":"1px solid #d8d8d8","padding":"5px"})}else{debug(TableID+"返回数据为空,或返回格式不正确")}}},error:function(msg){Animation(TableID,'stop');status(msg)}})}function GerRowData(TdNode){var row=TdNode.getAttribute("data-row");if(row!=null&&row!=""){return row}return 0}function debug(msg){if(DebugMsg){$("body").append("<div class='DataTableDebugMsg'>DataTable调试信息: <span style='color: #ff5c6f;'>"+msg+"!</span><a class='debugOut' href='javascript:void(0);'>(点我隐藏此条信息)</a></div>");var DataTableDebugMsg=$(".DataTableDebugMsg");var debugOut=$(".debugOut");DataTableDebugMsg.css({"position":"fixed","z-index":"9999","margin":"0 auto","left":"0","right":"0","background":"#FCFCFC","font-size":"12px","font-family":'"Microsoft YaHei", "微软雅黑", helvetica, arial, verdana, tahoma, sans-serif',"color":"#000000","height":"60px","width":"70%","text-align":"center","line-height":"60px","border":"1px solid #d8d8d8","border-radius":"3px","top":"45%"});debugOut.css({"margin":"0 10px","text-decoration":"none"});debugOut.click(6000,function(){$(this).parent().remove()})}return false}d.fn.GetJSONArray=function(){var dt_id=d(this)[0].id;if(!empty(GetJSONData[dt_id])){return GetJSONData[dt_id]}return null};d.fn.TableRefresh=function(){var dt_id=d(this)[0].id;$('.'+dt_id+'_refresh').click()};d.fn.GetCheckArray=function(){var dt_id=d(this)[0].id;if(!empty(CheckData[dt_id])){return CheckData[dt_id]}return null}})(jQuery);